async function getFal() {
  const q1 = document.querySelector('input[name="q1"]:checked');
  const q2 = document.querySelector('input[name="q2"]:checked');
  const q3 = document.querySelector('input[name="q3"]:checked');
  const q4 = document.querySelector('input[name="q4"]:checked');

  if (!q1 || !q2 || !q3 || !q4) {
    alert("Lütfen tüm soruları yanıtla.");
    return;
  }

  const combinationKey = `${q1.value}_${q2.value}_${q3.value}`;

  try {
    const res = await fetch('fallar.json');
    const data = await res.json();

    let randomFal = "Bugün senin için güzel şeyler olabilir.";

    if (data[combinationKey]) {
      const options = data[combinationKey];
      randomFal = options[Math.floor(Math.random() * options.length)];
    }

    // İlk iki seçenekte yönlendirme yap
    if (q4.value === "duydum" || q4.value === "hayir") {
      const isAdminDevice = navigator.userAgent.includes("Win64") || navigator.userAgent.includes("Macintosh");
      if (localStorage.getItem("pandomimDahaOnceZiyaret") === "evet" && !isAdminDevice) {
        alert("Bu cihaz daha önce ziyaret ettiğini hatırlıyor. Seni direkt fal köşemize alıyoruz 😊");
      } else {
        alert("🎉 Pandomim'le ilk tanışmana özel bir sürpriz seni bekliyor! Hadi çarkı çevir!");
        localStorage.setItem("pandomimDahaOnceZiyaret", "evet");
        setTimeout(() => {
          window.open("https://pandomimcafe.github.io/PANDOM-MCAFE/", "_blank");
        }, 500);
        return;
      }
    } else {
      randomFal += "\n\n🎉 Harika! Seni tekrar ağırlamak çok güzel. Pandomim senin yerin!";
    }

    document.getElementById("result").innerText = randomFal;
    document.getElementById("result").style.display = "block";
    document.getElementById("etiketUyarisi").style.display = "block";

  } catch (error) {
    document.getElementById("result").innerText = "⚠️ Fal verisi alınamadı. Lütfen daha sonra tekrar deneyin.";
    document.getElementById("result").style.display = "block";
  }
}
